```{r message=FALSE}
library(tidyverse)
library(here)
library(lmerTest)
library(dotenv)

load_dot_env(file=here(".env"))
PROJECT_VERSION = Sys.getenv("PROJECT_VERSION")
```

### Load data
```{r}
trial_metadata <- read.csv(here("data","metadata","trial_metadata.csv"))
trial_summary_data <- read.csv(here("data",PROJECT_VERSION, "processed_data","trial_summary_data.csv"))

usable_trials <- trial_summary_data |>
  filter(exclude_participant_insufficient_data == 0 & trial_exclusion == 0 & exclude_participant == 0) 

# Merging with similarity information and mean-centering main effects
trials_with_effect_vars <- usable_trials |>
  left_join(trial_metadata) |>
  mutate(text_similarity_centered = (text_similarity - mean(text_similarity, na.rm = TRUE)),
         # Converting scale of age to months from days before centering
         test_age_centered = (SubjectInfo.testAge / 30 - mean(SubjectInfo.testAge / 30 , na.rm = TRUE))
  )
```

### Run mixed-effects model
```{r message=FALSE}
main_effect <- lmer(corrected_target_looking ~ (text_similarity_centered * test_age_centered) 
                    + (text_similarity_centered | SubjectInfo.subjID) 
                    + (1|Trials.targetImage) 
                    + (1|Trials.imagePair), 
                    data = trials_with_effect_vars)


age_effect <- lmer(corrected_target_looking ~ (test_age_centered) 
                    + (1|Trials.targetImage) 
                    + (1|Trials.imagePair), 
                    data = trials_with_effect_vars)

summary(main_effect)
anova(main_effect)

```